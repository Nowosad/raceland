---
title: "An examples of the workflow in the racialscape package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(racialscape)
library(raster)
library(sf)
# library(tmap)
```

# Data

<!-- data intro -->
<!-- describe the data -->

```{r}
prop_raster
plot(prop_raster)
# tm_shape(prop_raster) + 
#   tm_raster(palette = "viridis", title = "Share of population:") +
#   tm_facets(free.scales = FALSE) +
# 	tm_layout(panel.labels = names(prop_raster))
```

# Create realizations

```{r}
real_raster = create_realizations(prop_raster, n = 5)
plot(real_raster)
# tm_shape(real_raster) + 
#   tm_raster(style = "cat", palette = "Set2", title = "Category:", 
#             labels = names(prop_raster)) +
#   tm_facets(free.scales = FALSE)
```

# Create weights

```{r}
weig_raster = create_weights(real_raster, prop_raster, size = 4)
plot(weig_raster)
# tm_shape(weig_raster) +
  # tm_raster(palette = "viridis", title = "Weights:") +
  # tm_facets(free.scales = FALSE)
```

# Calculate metrics

```{r}
metr_df = calculate_metrics(real_raster, weig_raster,
                        neighbourhood = 4, fun = "mean", size = 4)
head(metr_df)
```

# Connect metrics to a grid

```{r}
grid_sf = create_grid(real_raster, size = 4)
grid_sf = merge(grid_sf, metr_df, by = c("row", "col"), all.x = TRUE)
plot(subset(grid_sf, realization == 1))
# tm_shape(grid_sf) +
#   tm_polygons("ent", style = "cont") +
#   tm_facets(by = "realization")
```

