<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>raceland: R package for a pattern-based, zoneless method for analysis and visualization of racial topography • raceland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="raceland: R package for a pattern-based, zoneless method for analysis and visualization of racial topography">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raceland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raceland-intro1.html">raceland: R package for a pattern-based, zoneless method for analysis and visualization of racial topography</a>
    </li>
    <li>
      <a href="../articles/raceland-intro2.html">raceland: Describing local racial patterns of racial landscapes at different spatial scales</a>
    </li>
    <li>
      <a href="../articles/raceland-intro3.html">raceland: Describing local pattern of racial landscape using SocScape grids</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/raceland/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>raceland: R package for a pattern-based,
zoneless method for analysis and visualization of racial topography</h1>
                        <h4 data-toc-skip class="author">Anna Dmowska,
Tomasz Stepinski, Jakub Nowosad</h4>
            
            <h4 data-toc-skip class="date">2026-01-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/raceland/blob/master/vignettes/raceland-intro1.Rmd" class="external-link"><code>vignettes/raceland-intro1.Rmd</code></a></small>
      <div class="hidden name"><code>raceland-intro1.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">INTRODUCTION<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>raceland</strong> package implements a computational
framework for a pattern-based, zoneless analysis and visualization of
(ethno)racial topography. It is a reimagined approach for analyzing
residential segregation and racial diversity based on the concept of
‘landscape’ used in the domain of landscape ecology.</p>
<p>The proposed approach adopts a bird’s view perspective - in which
visualization and quantification of racial topography (an overall
organization of a spatial pattern formed by locations of people of
different races) are tightly intertwined by using the same data - a
high-resolution raster grid with each cell containing only inhabitants
of a single race. Such grids represent <strong><em>a racial landscape
(RL).</em></strong> A <em>racial landscape (RL)</em> consists of the
mosaic of many large and small patches (racial enclaves) formed by
adjacent raster grid cells having the same race categories. The
distribution of racial enclaves creates a specific spatial pattern.</p>
<p>The racial landscape is described by <em>exposure matrix</em> and
quantified by two metrics (entropy and mutual information) derived from
Information Theory concept (IT). Entropy is the measure of racial
diversity and mutual information measures racial segregation.</p>
<p><strong>Racial landscape method</strong> is based on the raster
gridded data, and unlike the previous methods, does not depend on the
division for specific zones (census tract, census block, etc.).
Calculation of racial diversity (entropy) and racial segregation (mutual
information) can be performed for the whole area of interests (i.e.,
metropolitan area) without introducing any arbitrary divisions. Racial
landscape method also allows for performing the calculation at different
spatial scales.</p>
</div>
<div class="section level2">
<h2 id="a-computational-framework">A COMPUTATIONAL FRAMEWORK<a class="anchor" aria-label="anchor" href="#a-computational-framework"></a>
</h2>
<p>A computational framework implemented in the
<strong>raceland</strong> package allows for:</p>
<ol style="list-style-type: decimal">
<li><p>Constructing racial landscape based on race-specific raster
grids.</p></li>
<li><p>Describing the racial pattern of a racial landscape at different
scales or/and for the whole area of interests using metrics derived from
Information Theory concept (entropy and mutual information).</p></li>
<li><p>Mapping the racial landscape.</p></li>
<li><p>Mapping racial diversity and segregation at different
scales.</p></li>
</ol>
<p>The computational framework consists of the four steps (see figure
below, the blue font indicates the names of function from the
<strong>raceland</strong> package).</p>
<p><img src="fig0framework.png" class="r-plt" alt="" width="800"></p>
<div class="section level3">
<h3 id="required-packages">Required packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>The computational framework requires following packages:
<strong>raceland</strong>, <strong>comat</strong>,
<strong>terra</strong>, <strong>sf</strong>, and
<strong>dplyr</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install required packages </span></span>
<span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"raceland"</span>,                </span>
<span>  <span class="st">"comat"</span>,            </span>
<span>  <span class="st">"terra"</span>,</span>
<span>  <span class="st">"sf"</span>,              </span>
<span>  <span class="st">"dplyr"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">to_install</span> <span class="op">=</span> <span class="op">!</span><span class="va">pkgs</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">to_install</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">to_install</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>Racial landscape method is based on high-resolution race-specific
raster grids. Each cell in race-specific grids contains race
subpopulation density. SocScape project provides high-resolution raster
grids for 1990, 2000, 2010 years for 365 metropolitan areas and each
county in the conterminous US. Data is available at <a href="http://www.socscape.edu.pl/index.php?id=high-resolution-grids/" class="external-link uri">http://www.socscape.edu.pl/index.php?id=high-resolution-grids/</a>.</p>
<p>The calculation can also be performed using a spatial vector file
(e.g., shapefile) with attribute table containing race counts for
aggregated data. In such case, a spatial vector object is first
rasterized using the <code>zones_to_rasters()</code> function from the
<strong>raceland</strong> package (people of a given race are
redistributed to the cells by dividing the number of people by the
number of cells belonging to the particular spatial units).</p>
<p>Please notice that the rasterization time depends on the number of
divisions and for large areas (i.e., metropolitan areas) can be
time-consuming. It is recommended to use the smallest available
divisions.</p>
<p>Here we demonstrate a computational framework using an example of the
area of 60x60 cells. The input data is a high-resolution (30m) raster
grids. Race-specific rasters are stored as GeoTIFFs (the directory
contains five files for five race-groups: Asians, Blacks, Hispanic,
others and Whites).</p>
<p>The SpatRaster with race-specific grids is created based on the
GeoTIFF files (files will be sorted and read into SpatRaster in
alphabetical order; the categories in the racial landscape will depend
on the order of layers in input data - see details in the next
section).</p>
<div class="section level4">
<h4 id="working-with-high-resolution-grids">Working with high resolution grids<a class="anchor" aria-label="anchor" href="#working-with-high-resolution-grids"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rast_data"</span>, package <span class="op">=</span> <span class="st">"raceland"</span><span class="op">)</span>,</span>
<span>                         full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">race_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">list_raster</span><span class="op">)</span></span>
<span><span class="va">race_raster</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 60, 60, 5  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 685545, 687345, 2103255, 2105055  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span></span>
<span><span class="co">#&gt; sources     : asian.tif  </span></span>
<span><span class="co">#&gt;               black.tif  </span></span>
<span><span class="co">#&gt;               hispanic.tif  </span></span>
<span><span class="co">#&gt;               ... and 2 more sources</span></span>
<span><span class="co">#&gt; names       :    asian,   black, hispanic,     other, white </span></span>
<span><span class="co">#&gt; min values  : 0.000000,  0.0000, 0.000000, 0.0000000,  0.00 </span></span>
<span><span class="co">#&gt; max values  : 1.333333, 15.3125, 9.666667, 0.5714286,  3.75</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">race_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro1_files/figure-html/fig1-1.png" class="r-plt" alt="" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="working-with-vector-data">Working with vector data<a class="anchor" aria-label="anchor" href="#working-with-vector-data"></a>
</h4>
<p>While using spatial vector data, the file should be read to R using
the <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> function from the <strong>sf</strong>
package. In the next step spatial object is rasterized using
<code>zones_to_rasters()</code> from the <strong>raceland</strong>
package.</p>
<p>Function <code>zones_to_rasters()</code> requires three
arguments:</p>
<ul>
<li>
<code>v</code> - an sf object with aggregated attribute data</li>
<li>
<code>resolution</code> - a resolution of the output raster (below
we use <code>resolution=30</code>, which is the same resolution as used
in the SocScape grids)</li>
<li>
<code>variables</code> - a character vector with columns names from
<em>v</em>. The values from these columns will be (1) rasterized and (2)
recalculated to densities. Each column will be represented as a layer in
the output SpatRaster.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pf_to_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"vect_data/block_data.gpkg"</span>, package <span class="op">=</span> <span class="st">"raceland"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vect_data</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">pf_to_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `block_data' from data source </span></span>
<span><span class="co">#&gt;   `/home/runner/work/_temp/Library/raceland/vect_data/block_data.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 264 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 685545 ymin: 496468.7 xmax: 687345 ymax: 498268.7</span></span>
<span><span class="co">#&gt; Projected CRS: unnamed</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vect_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GISJOIN"  "ASIAN"    "BLACK"    "HISPANIC" "OTHER"    "WHITE"    "geom"</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">race_raster_from_vect</span> <span class="op">=</span> <span class="fu"><a href="../reference/zones_to_raster.html">zones_to_raster</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">vect_data</span>,</span>
<span>                                        resolution <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                                        variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASIAN"</span>, <span class="st">"BLACK"</span>, <span class="st">"HISPANIC"</span>, <span class="st">"OTHER"</span>, <span class="st">"WHITE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Once vector data is rasterized, there is no difference, whether
race_raster object or race_raster_from_vect will be used for further
analysis.</p>
</div>
</div>
<div class="section level3">
<h3 id="constructing-racial-landscape">Constructing racial landscape<a class="anchor" aria-label="anchor" href="#constructing-racial-landscape"></a>
</h3>
<p>The racial landscape is a high-resolution grid in which each cell
contains only inhabitants of a single race.</p>
<p>The racial landscape is constructed based on race-specific grids.
Racial composition at each cell is translated to probabilities of
drawing a person of a specific race from a cell. Thus, the race label of
a cell is a random variable. To obtain a stochastic realization of
racial landscape, we use the cell’s race probabilities and a random
number generator to randomly assign specific race label to each cell
(Monte Carlo procedure).</p>
<p>Multiple draws yield to a series of realization with a slightly
different pattern (see example below). The pattern uncertainty occurs
only at sub-block scale and only if there is significant sub-block
racial diversity.</p>
<p>A single realization-based visualization is sufficiently accurate.
For increased accuracy, racial topography is quantified as an ensemble
average from multiple realizations. It is recommended to calculate at
least 30 realizations.</p>
<p>Realization is constructed using the
<code><a href="../reference/create_realizations.html">create_realizations()</a></code> function with two arguments:</p>
<ul>
<li>
<code>x</code> - SpatRaster with race-specific population densities
assign to each cell</li>
<li>
<code>n</code> - A number of realizations to generate</li>
</ul>
<p>Function returns <em>SpatRaster</em> object containing <em>n</em>
realizations. Single race label in a racial landscape is assigned based
on the order of race-specific grids stored in SpatRaster. For example,
<em>race_raster</em> object has five layers named: asian, black,
hispanic, other, white. The race labels in racial landscape raster will
be 1 - asian, 2- black, 3 - hispanic, 4 - other, 5 - white.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate 100 realizations based on race_raster object</span></span>
<span><span class="va">real_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_realizations.html">create_realizations</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">race_raster</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot five first realizations</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">real_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F16667"</span>, <span class="st">"#6EBE44"</span>, <span class="st">"#7E69AF"</span>, <span class="st">"#C77213"</span>, <span class="st">"#F8DF1D"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro1_files/figure-html/fig2-1.png" class="r-plt" alt="" width="100%" style="display: block; margin: auto;"></p>
<p>The racial landscape provides a skewed visualization of the racial
pattern because it does not take into consideration the spatial
variability of the population densities. To obtain an accurate depiction
of racial distribution, the values of RL must be modified to reflect
race and subpopulation densities.</p>
<p>Function <code><a href="../reference/plot_realization.html">plot_realization()</a></code> display realization taking
into account also subpopulation density. The function takes three
arguments:</p>
<ul>
<li>
<code>x</code> - A raster object (RasterLayer, SpatRaster,
RasterBrick) with one selected realization representing a racial
landscape</li>
<li>
<code>y</code> - SpatRaster with race-specific population
densities</li>
<li>
<code>hex</code> - A character vector with colors specified in
hexadecimal format. Colors should correspond to categories in
realization (racial landscape)</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In race_colors first color corresponds to asian, second to black,</span></span>
<span><span class="co"># third to hispanics, fourth to other and fifth to white)</span></span>
<span><span class="va">race_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F16667"</span>, <span class="st">"#6EBE44"</span>, <span class="st">"#7E69AF"</span>, <span class="st">"#C77213"</span>, <span class="st">"#F8DF1D"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_realization.html">plot_realization</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">race_raster</span>, hex <span class="op">=</span> <span class="va">race_colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro1_files/figure-html/fig3-1.png" class="r-plt" alt="" width="40%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="describing-racial-patterns-of-racial-landscape">Describing racial patterns of racial landscape<a class="anchor" aria-label="anchor" href="#describing-racial-patterns-of-racial-landscape"></a>
</h3>
<p>The exposure matrix describes a racial pattern. In the domain of
landscape ecology, landscape pattern can be described by a co-occurrence
matrix. The co-occurrence matrix is a tabulation of cells’ adjacencies.
Adjacencies between pairs of cells are defined by 4-connectivity rule
(There are max. 4 adjacencies: north, east, south, and west cell as is
shown in the figure below).</p>
<p><img src="fig1adjacencies.png" class="r-plt" alt="" width="100%"></p>
<p>The co-occurrence matrix has the size K x K (K - number of
categories), is symmetrical and can be calculated for any region
regardless of its size or shape.</p>
<p>Exposure matrix is a modification of co-occurrence matrix. The
exposure matrix is calculated in the same way as the co-occurrence
matrix, but each adjacency contributes as a location-specific value to
the matrix instead of the constant value 1. The contributed value is
calculated as the average of local population densities in the two
adjacent cells.</p>
<p>Let consider an example of the racial landscape presented below. The
co-occurrence matrix is constructed using only adjacencies from the
racial landscape. To obtain an exposure matrix, each cell in the racial
landscape has assigned two types of information: single race class and
local population density. Considering two green adjacent cells - this
pair will contribute 1 to the co-occurrence matrix (one adjacent pair)
and the average from 2 and 1 ((2+1)/2)=1.5) to the exposure matrix.</p>
<p><img src="fig2matrix.png" class="r-plt" alt="" width="100%"></p>
<div class="section level4">
<h4 id="calculating-local-subpopulation-densities">Calculating local subpopulation densities<a class="anchor" aria-label="anchor" href="#calculating-local-subpopulation-densities"></a>
</h4>
<p>Local densities of subpopulations (race-specific local densities)
along with racial landscapes are used to construct the exposure matrix.
Local densities are calculated using the <code><a href="../reference/create_densities.html">create_densities()</a></code>
function, which requires three arguments:</p>
<ul>
<li>
<code>x</code> - SpatRaster with realizations</li>
<li>
<code>y</code> - SpatRaster with shares of subpopulations (input
data SpatRaster)</li>
<li>
<code>window_size</code> - the size, expressed in the number of
cells, of a square-shaped window for which local densities will be
calculated; it is recommended to use the small window_size, i.e., 10
(<code>window_size=10</code> means that the local densities will be
calculated from the area of 10 x 10 cells).</li>
</ul>
<p>The output is a SpatRaster with local densities calculated separately
for each realization.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dens_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_densities.html">create_densities</a></span><span class="op">(</span><span class="va">real_raster</span>, <span class="va">race_raster</span>, window_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="exposure-matrix">Exposure matrix<a class="anchor" aria-label="anchor" href="#exposure-matrix"></a>
</h4>
<p>Here we show an example, how the exposure matrix is calculated.
Please notice, that the calculation of the exposure matrix is build-in
into the <code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code> function and there is no need
to calculate exposure matrix separately.</p>
<p>Exposure matrix can be calculated separately using the
<code>get_wecoma()</code> function from the <strong>comat</strong>
package. Calculation of exposure matrix requires two arguments:</p>
<ul>
<li>
<code>x</code> - RasterLayer with one selected realization</li>
<li>
<code>y</code> - RasterLayer with local densities corresponding to
selected realizations.</li>
</ul>
<p>As default, the exposure matrix with 4-directions adjacencies
(<code>neighboorhood = 4</code>) is calculated using the average values
from 2 adjacent cells (<code>fun = "mean"</code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exposure_mat</span> <span class="op">=</span> <span class="fu">comat</span><span class="fu">::</span><span class="fu"><a href="https://jakubnowosad.com/comat/reference/get_wecoma.html" class="external-link">get_wecoma</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">real_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, wide <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                                 w <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dens_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, wide <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exposure_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASIAN"</span>, <span class="st">"BLACK"</span>, <span class="st">"HISPANIC"</span>, <span class="st">"OTHER"</span>, <span class="st">"WHITE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exposure_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASIAN"</span>, <span class="st">"BLACK"</span>, <span class="st">"HISPANIC"</span>, <span class="st">"OTHER"</span>, <span class="st">"WHITE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">exposure_mat</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ASIAN   BLACK HISPANIC  OTHER   WHITE</span></span>
<span><span class="co">#&gt; ASIAN     0.58   42.53    71.42   2.35   29.15</span></span>
<span><span class="co">#&gt; BLACK    42.53 7116.02  3290.02 136.00 1735.73</span></span>
<span><span class="co">#&gt; HISPANIC 71.42 3290.02  9843.18 142.25 3739.69</span></span>
<span><span class="co">#&gt; OTHER     2.35  136.00   142.25  17.20   49.11</span></span>
<span><span class="co">#&gt; WHITE    29.15 1735.73  3739.69  49.11 3263.18</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="information-theory-metrics-it-metrics">Information theory metrics (IT metrics)<a class="anchor" aria-label="anchor" href="#information-theory-metrics-it-metrics"></a>
</h4>
<p>For lucid quantification of racial topography, further compression of
the exposure matrix is required. A racial pattern can be described (in
the same way as landscape pattern in the domain of landscape ecology) by
using Information Theory metrics - entropy and mutual information.
Entropy is associated with measuring racial diversity, and mutual
information is associated with measuring racial segregation.</p>
<p>Information theory metrics are calculated using function
<code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code>. This function calculates the exposure
matrix and summarizes it by calculating four IT-derived matrics: entropy
(ent), joint entropy (joinent), conditional entropy (condent) and mutual
information (mutinf). The function requires the following arguments:</p>
<ul>
<li>
<code>x</code> - SpatRaster with realizations</li>
<li>
<code>w</code> - SpatRaster with local densities</li>
<li>
<code>neighboorhood</code> - adjacencies between cells can be
defined in 4 directions (<code>neighboorhood = 4</code>) or 8 directions
(<code>neighboorhood = 8</code>).</li>
<li>
<code>fun</code> - function to calculate values from adjacent cells
to contribute to the exposure matrix, <code>fun = 'mean'</code>
calculate average values of population density from two adjacent cells.
Other available options are geometric mean
(<code>'geometry_mean'</code>) or value from a focal cell
(<code>'focal</code>’)</li>
<li>
<code>size = NULL</code> - calculation will be performed for the
whole area (see explanation later)</li>
<li>
<code>threshold</code> - the share of NA cells to allow metrics
calculation. <code>threshold = 1</code> - calculation will be performed,
even if there are 100% cells with NA values (recommended with
<code>size = NULL</code>)</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metr_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_metrics.html">calculate_metrics</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_raster</span>, w <span class="op">=</span> <span class="va">dens_raster</span>, </span>
<span>                            neighbourhood <span class="op">=</span> <span class="fl">4</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, </span>
<span>                            size <span class="op">=</span> <span class="cn">NULL</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metr_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   realization row col      ent  joinent  condent    mutinf</span></span>
<span><span class="co">#&gt; 1           1   1   1 1.623898 3.128522 1.504624 0.1192737</span></span>
<span><span class="co">#&gt; 2           2   1   1 1.627274 3.133749 1.506475 0.1207986</span></span>
<span><span class="co">#&gt; 3           3   1   1 1.644503 3.166851 1.522348 0.1221558</span></span>
<span><span class="co">#&gt; 4           4   1   1 1.643599 3.160675 1.517076 0.1265228</span></span>
<span><span class="co">#&gt; 5           5   1   1 1.641598 3.156520 1.514922 0.1266760</span></span>
<span><span class="co">#&gt; 6           6   1   1 1.631424 3.154740 1.523316 0.1081087</span></span></code></pre></div>
<p>IT metrics are calculated for each realization separately, and in the
next step, an average value from all realization is calculated.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">metr_df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ent"</span>, <span class="st">"mutinf"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;       ent            mutinf       </span></span>
<span><span class="co">#&gt;  Min.   :1.616   Min.   :0.09612  </span></span>
<span><span class="co">#&gt;  1st Qu.:1.628   1st Qu.:0.10688  </span></span>
<span><span class="co">#&gt;  Median :1.633   Median :0.11257  </span></span>
<span><span class="co">#&gt;  Mean   :1.634   Mean   :0.11305  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.640   3rd Qu.:0.11944  </span></span>
<span><span class="co">#&gt;  Max.   :1.653   Max.   :0.13195</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metr_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_ent <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  sd_ent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  mean_mutinf <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mutinf</span><span class="op">)</span>,</span>
<span>  sd_mutinf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">mutinf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mean_ent     sd_ent mean_mutinf   sd_mutinf</span></span>
<span><span class="co">#&gt; 1 1.634021 0.00804497   0.1130538 0.008298721</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jakub Nowosad, Anna Dmowska, Tomasz Stepinski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
