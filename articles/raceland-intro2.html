<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>raceland: Describing local racial patterns of racial landscapes at different spatial scales • raceland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="raceland: Describing local racial patterns of racial landscapes at different spatial scales">
<meta property="og:description" content="raceland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raceland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raceland-intro1.html">raceland: R package for a pattern-based, zoneless method for analysis and visualization of racial topography</a>
    </li>
    <li>
      <a href="../articles/raceland-intro2.html">raceland: Describing local racial patterns of racial landscapes at different spatial scales</a>
    </li>
    <li>
      <a href="../articles/raceland-intro3.html">raceland: Describing local pattern of racial landscape using SocScape grids</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/raceland/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>raceland: Describing local racial patterns of
racial landscapes at different spatial scales</h1>
                        <h4 data-toc-skip class="author">Anna Dmowska,
Tomasz Stepinski, Jakub Nowosad</h4>
            
            <h4 data-toc-skip class="date">2023-04-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/raceland/blob/HEAD/vignettes/raceland-intro2.Rmd" class="external-link"><code>vignettes/raceland-intro2.Rmd</code></a></small>
      <div class="hidden name"><code>raceland-intro2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">INTRODUCTION<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>raceland</strong> package implements a computational
framework for a pattern-based, zoneless analysis and visualization of
(ethno)racial topography. It is a reimagined approach for analyzing
residential segregation and racial diversity based on the concept of
‘landscape’ used in the domain of landscape ecology. An overview of the
implemented method is presented in the first vignette. Here we
demonstrate, how the <strong>raceland</strong> package can be used for
describing racial landscape at different spatial scales.</p>
<p><strong>Racial landscape method</strong> is based on the raster
gridded data, and unlike the previous methods, does not depend on the
division for specific zones (census tract, census block, etc.).
Calculation of racial diversity (entropy) and racial segregation (mutual
information) can be performed for the whole area of interests (i.e.,
metropolitan area) without introducing any arbitrary divisions. Racial
landscape method also allows for performing the calculation at different
spatial scales.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install required packages </span></span>
<span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"raceland"</span>,                </span>
<span>  <span class="st">"comat"</span>,            </span>
<span>  <span class="st">"terra"</span>,   </span>
<span>  <span class="st">"sf"</span>,              </span>
<span>  <span class="st">"dplyr"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">to_install</span> <span class="op">=</span> <span class="op">!</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">to_install</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">to_install</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A computational framework requires a few steps (see the first
vignette for details) before calculating IT-metrics:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reading input data</span></span>
<span><span class="va">list_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rast_data"</span>, package <span class="op">=</span> <span class="st">"raceland"</span><span class="op">)</span>,</span>
<span>                         full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">race_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">list_raster</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># constructing racial landscape</span></span>
<span><span class="va">real_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_realizations.html">create_realizations</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">race_raster</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculating local subpopulation densities</span></span>
<span><span class="va">dens_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_densities.html">create_densities</a></span><span class="op">(</span><span class="va">real_raster</span>, <span class="va">race_raster</span>, window_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="describing-local-racial-patterns-of-racial-landscapes-at-different-spatial-scales">DESCRIBING LOCAL RACIAL PATTERNS OF RACIAL LANDSCAPES AT DIFFERENT
SPATIAL SCALES<a class="anchor" aria-label="anchor" href="#describing-local-racial-patterns-of-racial-landscapes-at-different-spatial-scales"></a>
</h2>
<div class="section level3">
<h3 id="defining-local-patterns">Defining local patterns<a class="anchor" aria-label="anchor" href="#defining-local-patterns"></a>
</h3>
<p>Let consider an example presented below. The racial landscape covers
the area of 16 by 16 cells. Such an area can be divided into a
square-shaped block of cells. Each square of cells will represent a
local pattern (a local landscape), and for each local pattern, IT
metrics (entropy and mutual information) are calculated. The extent of a
local pattern is defined by two parameters: <em>size</em> and
<em>shift</em>.</p>
<ul>
<li>
<em>Size</em> parameter, expressed in the numbers of cells, is a
length of the side of a square-shaped block of cells. It defines the
extent of a local pattern.</li>
<li>
<em>Shift</em> parameter defines the shift between adjacent squares
of cells along with the N-S and W-E directions. It describes the density
(resolution) of the output grid. The resolution of the output map will
be reduced to the new resolution = original resolution x shift. When:
<ul>
<li><p>shift == size - the input map will be divided into a grid of
non-overlaping square windows. Each square window defines the extent of
a local pattern.</p></li>
<li><p>shift &lt; size - results in the grid of overlapping square
windows. A local pattern is calculated from the square window defined by
size parameter; the next square window is shifted (in N-S and W-E
directions) by the number of cells defined by <em>shift</em>
parameter.</p></li>
</ul>
</li>
</ul>
<p>The example presented below consists of the racial landscape 16 by 16
cells. Setting <code>size = 4</code> (and <code>shift= 4</code>) results
in dividing the racial landscape into four squared windows, each 4x4
cells. Each window represents a local pattern. For each local pattern,
IT metrics can be calculated, and the results will be assigned to the
resultant grid of square windows. In fact, the original racial landscape
with 16x16 cells is reduced to the 2x2 ‘large cells’.</p>
<p>Setting <code>size=4</code> and <code>shift = 2</code> results in
overlapping square windows. First, the window of the size 4x4 defines
the local pattern (see dark blue square). In the next step, this window
is shifted by two cells to the right, and the new local pattern is
selected (see the light blue square). It will create a resultant grid of
the cell size defined by the shift parameter.</p>
<p><img src="fig3size_shift.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="calculate-it-metrics-from-local-patterns-1">Calculate IT metrics from local patterns (1)<a class="anchor" aria-label="anchor" href="#calculate-it-metrics-from-local-patterns-1"></a>
</h3>
<p>The <code><a href="../reference/create_grid.html">create_grid()</a></code> function creates spatial object with a
grid (each ‘cell’ is defined by size and shift). This function requires
the SpatRaster object with realizations (racial landscapes) and size
parameter. If the shift parameter is not set, it is assumed that
<code>size=shift</code>. Below such grid is imposed into the racial
landscape to show local patterns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">race_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F16667"</span>, <span class="st">"#6EBE44"</span>, <span class="st">"#7E69AF"</span>, <span class="st">"#C77213"</span>, <span class="st">"#F8DF1D"</span><span class="op">)</span></span>
<span><span class="va">grid_sf</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_grid.html">create_grid</a></span><span class="op">(</span><span class="va">real_raster</span>, size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_realization.html">plot_realization</a></span><span class="op">(</span><span class="va">real_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">race_raster</span>, hex <span class="op">=</span> <span class="va">race_colors</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">grid_sf</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/fig5-1.png" width="40%" style="display: block; margin: auto;"></p>
<p>The <code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code> function is used to calculate IT
metrics. Parameter <code>size=20</code> means that the area of interests
will be divided into a grid of local patterns of the size 20x20 cells
(which in this case corresponds to the square of 0.6 km x 0.6km). The
<code>neighboorhood = 4</code> defines that adjacencies between cells
are defined in four directions, <code>fun="mean"</code> calculate
average values of population density from adjacent cells,
<code>threshold = 0.5</code> - calculation will be performed if there is
at least 50% of non-NA cells.</p>
<p>IT metrics are calculated for each local pattern for each
realization. The output table will have 900 rows (there are nine local
patterns of size 20x20 cells and 100 realizations).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metr_df_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_metrics.html">calculate_metrics</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_raster</span>, w <span class="op">=</span> <span class="va">dens_raster</span>, </span>
<span>                               neighbourhood <span class="op">=</span> <span class="fl">4</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, </span>
<span>                               size <span class="op">=</span> <span class="fl">20</span>, threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">metr_df_20</span><span class="op">[</span><span class="va">metr_df_20</span><span class="op">$</span><span class="va">realization</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   realization row col      ent  joinent  condent     mutinf</span></span>
<span><span class="co">#&gt; 1           1   1   1 1.242714 2.460145 1.217431 0.02528272</span></span>
<span><span class="co">#&gt; 2           1   1   2 1.604037 2.983945 1.379908 0.22412918</span></span>
<span><span class="co">#&gt; 3           1   1   3 1.384157 2.710090 1.325933 0.05822412</span></span>
<span><span class="co">#&gt; 4           1   2   1 1.617792 3.096965 1.479173 0.13861946</span></span>
<span><span class="co">#&gt; 5           1   2   2 1.438690 2.838910 1.400220 0.03847000</span></span>
<span><span class="co">#&gt; 6           1   2   3 1.517492 2.843154 1.325661 0.19183098</span></span>
<span><span class="co">#&gt; 7           1   3   1 1.403505 2.689343 1.285838 0.11766679</span></span>
<span><span class="co">#&gt; 8           1   3   2 1.584734 3.157436 1.572702 0.01203280</span></span>
<span><span class="co">#&gt; 9           1   3   3 1.352445 2.668592 1.316147 0.03629842</span></span></code></pre></div>
<p>Racial topography at the analyzed scale is quantified as an ensemble
average from multiple realizations. First, for each square window is
calculated the average value of entropy and mutual information based on
100 realizations. The table below shows the mean (<code>ent_mean</code>,
<code>mutinf_mean</code>) and standard deviation (<code>ent_sd</code>,
<code>mutinf_sd</code>) values for each square window.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smr</span> <span class="op">=</span> <span class="va">metr_df_20</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    ent_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    ent_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    mutinf_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mutinf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    mutinf_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">mutinf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'row'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span>
<span><span class="va">smr</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   row [3]</span></span></span>
<span><span class="co">#&gt;     row   col ent_mean ent_sd mutinf_mean mutinf_sd</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     1     1.27 0.041<span style="text-decoration: underline;">9</span>      0.020<span style="text-decoration: underline;">0</span>   0.008<span style="text-decoration: underline;">43</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1     2     1.59 0.011<span style="text-decoration: underline;">7</span>      0.162    0.029<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1     3     1.41 0.028<span style="text-decoration: underline;">7</span>      0.045<span style="text-decoration: underline;">3</span>   0.013<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2     1     1.61 0.025<span style="text-decoration: underline;">9</span>      0.155    0.038<span style="text-decoration: underline;">0</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2     2     1.52 0.023<span style="text-decoration: underline;">0</span>      0.035<span style="text-decoration: underline;">7</span>   0.011<span style="text-decoration: underline;">9</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2     3     1.51 0.028<span style="text-decoration: underline;">9</span>      0.151    0.025<span style="text-decoration: underline;">9</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     3     1     1.38 0.048<span style="text-decoration: underline;">4</span>      0.142    0.047<span style="text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     3     2     1.54 0.029<span style="text-decoration: underline;">0</span>      0.014<span style="text-decoration: underline;">8</span>   0.006<span style="text-decoration: underline;">75</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>     3     3     1.42 0.036<span style="text-decoration: underline;">0</span>      0.044<span style="text-decoration: underline;">7</span>   0.011<span style="text-decoration: underline;">4</span></span></span></code></pre></div>
<p>Then the averages from the mean values of entropy and mutual
information are calculated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">row</span>, <span class="op">-</span><span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise_all</span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   ent_mean ent_sd mutinf_mean mutinf_sd</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1.47 0.030<span style="text-decoration: underline;">4</span>      0.085<span style="text-decoration: underline;">6</span>    0.021<span style="text-decoration: underline;">4</span></span></span></code></pre></div>
<div class="section level4">
<h4 id="racial-diversity-segregation-classification">Racial diversity-segregation classification<a class="anchor" aria-label="anchor" href="#racial-diversity-segregation-classification"></a>
</h4>
<p>Racial diversity and segregation can be analyzed and displayed
separately. However, much more information can be gained by visualizing
those two measures at the same time. For this purpose, entropy and
mutual information are reclassified into three classes (1-low, 2-medium,
3-high). By joining those two classification, we obtain 9 classes, each
describing the level of diversity and segregation: 11 - low
segregation/low diversity; 12-low segregation/medium diversity; 13-low
segregation/high diversity; 21 - medium segregation/low diversity;
22-medium segregation/medium diversity; 23-medium segregation/high
diversity; 31 - high segregation/low diversity; 32-high
segregation/medium diversity; 33-high segregation/high diversity.</p>
<p>Each class is coded by one color using bivariate palette (see
below).</p>
<p><img src="fig4_bivariate.png" width="40%"></p>
<p>The <code>bivariate_classification()</code> function presented below
takes three arguments (<code>entropy</code> - a vector of entropy
values, <code>mutual_information</code> - a vector of mutual information
values, <code>n</code> - a number of categories in racial landscape) and
return a 9-coded vector of racial segregation/divesity classes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># n is a number of categories in racial landscape</span></span>
<span><span class="va">bivariate_classification</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">entropy</span>, <span class="va">mutual_information</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># calculate bivariate classification</span></span>
<span>  <span class="va">nent</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">ent_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">entropy</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.66</span>, <span class="fl">1.33</span>, <span class="va">nent</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                include.lowest <span class="op">=</span> <span class="cn">TRUE</span>, right <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">ent_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ent_cat</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mut_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">mutual_information</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.33</span>, <span class="fl">0.66</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>, </span>
<span>                include.lowest <span class="op">=</span> <span class="cn">TRUE</span>, right <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">mut_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">mut_cat</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">bivar_cls</span> <span class="op">=</span> <span class="va">mut_cat</span> <span class="op">+</span> <span class="va">ent_cat</span></span>
<span>  <span class="va">bivar_cls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">bivar_cls</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">bivar_cls</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smr</span><span class="op">$</span><span class="va">bivar_cls</span> <span class="op">=</span> <span class="fu">bivariate_classification</span><span class="op">(</span>entropy <span class="op">=</span> <span class="va">smr</span><span class="op">$</span><span class="va">ent_mean</span>, </span>
<span>                                         mutual_information <span class="op">=</span> <span class="va">smr</span><span class="op">$</span><span class="va">mutinf_mean</span>,</span>
<span>                                         n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">race_raster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mapping-local-racial-diversity-and-racial-segregation">Mapping local racial diversity and racial segregation<a class="anchor" aria-label="anchor" href="#mapping-local-racial-diversity-and-racial-segregation"></a>
</h4>
<p>The average value of entropy and mutual information calculated for
each square-shaped window from all realizations can be joined to the
spatial grid object. Such operation allows for mapping metrics and shows
how segregation and racial diversity change over the area.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join IT-metric to the grid</span></span>
<span><span class="va">attr_grid</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">grid_sf</span>, <span class="va">smr</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row"</span>, <span class="st">"col"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate breaks parameter for plotting entropy and mutual information</span></span>
<span><span class="co"># the values of entropy and mutual information are divided into equal breaks</span></span>
<span><span class="va">ent_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">race_raster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mut_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mapping-racial-diversity">Mapping racial diversity<a class="anchor" aria-label="anchor" href="#mapping-racial-diversity"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid</span><span class="op">[</span><span class="st">"ent_mean"</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">ent_breaks</span>, key.pos <span class="op">=</span> <span class="fl">1</span>, </span>
<span>     pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ent_breaks</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span>, main <span class="op">=</span> <span class="st">"Racial diversity (Entropy)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="mapping-racial-segregation">Mapping racial segregation<a class="anchor" aria-label="anchor" href="#mapping-racial-segregation"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid</span><span class="op">[</span><span class="st">"mutinf_mean"</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">mut_breaks</span>, key.pos <span class="op">=</span> <span class="fl">1</span>, </span>
<span>     pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mut_breaks</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span>, main <span class="op">=</span> <span class="st">"Racial segregation (Mutual information)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="mapping-racial-segregation-and-diversity-using-bivariate-classification">Mapping racial segregation and diversity using bivariate
classification<a class="anchor" aria-label="anchor" href="#mapping-racial-segregation-and-diversity-using-bivariate-classification"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biv_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"11"</span> <span class="op">=</span> <span class="st">"#e8e8e8"</span>, <span class="st">"12"</span> <span class="op">=</span> <span class="st">"#e4acac"</span>, <span class="st">"13"</span> <span class="op">=</span> <span class="st">"#c85a5a"</span>, <span class="st">"21"</span> <span class="op">=</span> <span class="st">"#b0d5df"</span>,</span>
<span>               <span class="st">"22"</span> <span class="op">=</span> <span class="st">"#ad9ea5"</span>, <span class="st">"23"</span> <span class="op">=</span> <span class="st">"#985356"</span>, <span class="st">"31"</span> <span class="op">=</span> <span class="st">"#64acbe"</span>, <span class="st">"32"</span><span class="op">=</span> <span class="st">"#627f8c"</span>, </span>
<span>               <span class="st">"33"</span> <span class="op">=</span> <span class="st">"#574249"</span><span class="op">)</span></span>
<span><span class="va">bcat</span> <span class="op">=</span> <span class="va">biv_colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">biv_colors</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">attr_grid</span><span class="op">$</span><span class="va">bivar_cls</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid</span><span class="op">[</span><span class="st">"bivar_cls"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">bcat</span>, main <span class="op">=</span> <span class="st">"Racial diversity and residential segregation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="calculate-it-metrics-from-local-patterns-overlapping-windows">Calculate IT metrics from local patterns (overlapping windows)<a class="anchor" aria-label="anchor" href="#calculate-it-metrics-from-local-patterns-overlapping-windows"></a>
</h4>
<p>The next example shows how to calculate a local pattern using
overlapping windows. This option is recommended to use, especially for a
larger size value. Using overlapping windows does not introduce
arbitrary boundaries.</p>
<p>To obtain overlapping windows the <code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code>
function requires additional argument - <code>shift</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate metrics for overlapping windows</span></span>
<span><span class="va">metr_df_10</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_metrics.html">calculate_metrics</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_raster</span>, w <span class="op">=</span> <span class="va">dens_raster</span>, </span>
<span>                               neighbourhood <span class="op">=</span> <span class="fl">4</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, </span>
<span>                               size <span class="op">=</span> <span class="fl">20</span>, shift <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">smr10</span> <span class="op">=</span> <span class="va">metr_df_10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    ent_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    ent_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ent</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    mutinf_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mutinf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    mutinf_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">mutinf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'row'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span>
<span></span>
<span><span class="va">smr10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">row</span>, <span class="op">-</span><span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise_all</span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   ent_mean ent_sd mutinf_mean mutinf_sd</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1.48 0.033<span style="text-decoration: underline;">5</span>      0.081<span style="text-decoration: underline;">5</span>    0.022<span style="text-decoration: underline;">4</span></span></span>
<span></span>
<span><span class="co"># calculate bivariate classification</span></span>
<span><span class="va">smr10</span><span class="op">$</span><span class="va">bivar_cls</span> <span class="op">=</span> <span class="fu">bivariate_classification</span><span class="op">(</span></span>
<span>  entropy <span class="op">=</span> <span class="va">smr10</span><span class="op">$</span><span class="va">ent_mean</span>,</span>
<span>  mutual_information <span class="op">=</span> <span class="va">smr10</span><span class="op">$</span><span class="va">mutinf_mean</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">race_raster</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mapping-local-racial-diversity-and-racial-segregation-1">Mapping local racial diversity and racial segregation<a class="anchor" aria-label="anchor" href="#mapping-local-racial-diversity-and-racial-segregation-1"></a>
</h3>
<p>The average value of entropy and mutual information calculated for
each square-shaped window from all realizations can be joined to spatial
grid object (created by <code><a href="../reference/create_grid.html">create_grid()</a></code>). For overlapping
windows, the resolution of the grid will be defined by <em>shift</em>
parameter.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create spatial grid object</span></span>
<span><span class="va">grid_sf10</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_grid.html">create_grid</a></span><span class="op">(</span><span class="va">real_raster</span>, size <span class="op">=</span> <span class="fl">20</span>, shift <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join IT-metrics to the grid</span></span>
<span><span class="va">attr_grid10</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">grid_sf10</span>, <span class="va">smr10</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row"</span>, <span class="st">"col"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="mapping-racial-diversity-1">Mapping racial diversity<a class="anchor" aria-label="anchor" href="#mapping-racial-diversity-1"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid10</span><span class="op">[</span><span class="st">"ent_mean"</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">ent_breaks</span>, key.pos <span class="op">=</span> <span class="fl">1</span>, </span>
<span>     pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ent_breaks</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     <span class="co"># pal = grDevices::hcl.colors(length(ent_breaks) - 1, palette = "Blue-Red"),</span></span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span>, main <span class="op">=</span> <span class="st">"Racial diversity (Entropy)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="mapping-racial-segregation-1">Mapping racial segregation<a class="anchor" aria-label="anchor" href="#mapping-racial-segregation-1"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid10</span><span class="op">[</span><span class="st">"mutinf_mean"</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">mut_breaks</span>, key.pos <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mut_breaks</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span>, main <span class="op">=</span> <span class="st">"Racial segregation (Mutual information)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="mapping-racial-segregation-and-diversity-using-bivariate-classification-1">Mapping racial segregation and diversity using bivariate
classification<a class="anchor" aria-label="anchor" href="#mapping-racial-segregation-and-diversity-using-bivariate-classification-1"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `biv_color`s defines a bivariate palette, </span></span>
<span><span class="co"># `bcat` selects only colors for categories available for analyzed areas</span></span>
<span><span class="va">biv_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"11"</span> <span class="op">=</span> <span class="st">"#e8e8e8"</span>, <span class="st">"12"</span> <span class="op">=</span> <span class="st">"#e4acac"</span>, <span class="st">"13"</span> <span class="op">=</span> <span class="st">"#c85a5a"</span>, <span class="st">"21"</span> <span class="op">=</span> <span class="st">"#b0d5df"</span>, </span>
<span>               <span class="st">"22"</span> <span class="op">=</span> <span class="st">"#ad9ea5"</span>, <span class="st">"23"</span> <span class="op">=</span> <span class="st">"#985356"</span>, <span class="st">"31"</span> <span class="op">=</span> <span class="st">"#64acbe"</span>,<span class="st">"32"</span> <span class="op">=</span> <span class="st">"#627f8c"</span>,</span>
<span>               <span class="st">"33"</span> <span class="op">=</span> <span class="st">"#574249"</span><span class="op">)</span></span>
<span><span class="va">bcat</span> <span class="op">=</span> <span class="va">biv_colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">biv_colors</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">attr_grid10</span><span class="op">$</span><span class="va">bivar_cls</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">attr_grid10</span><span class="op">[</span><span class="st">"bivar_cls"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="va">bcat</span>, main <span class="op">=</span> <span class="st">"Racial diversity and residential segregation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jakub Nowosad, Anna Dmowska, Tomasz Stepinski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
