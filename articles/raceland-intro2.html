<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>raceland: Describing local racial patterns of racial landscapes at different spatial scales • raceland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="raceland: Describing local racial patterns of racial landscapes at different spatial scales">
<meta property="og:description" content="raceland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raceland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raceland-intro1.html">raceland: R package for a pattern-based, zoneless method for analysis and visualization of racial topography</a>
    </li>
    <li>
      <a href="../articles/raceland-intro2.html">raceland: Describing local racial patterns of racial landscapes at different spatial scales</a>
    </li>
    <li>
      <a href="../articles/raceland-intro3.html">raceland: Describing local pattern of racial landscape using SocScape grids</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/raceland/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="raceland-intro2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>raceland: Describing local racial patterns of racial landscapes at different spatial scales</h1>
                        <h4 class="author">Anna Dmowska, Tomasz Stepinski, Jakub Nowosad</h4>
            
            <h4 class="date">2020-07-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/raceland/blob/master/vignettes/raceland-intro2.Rmd"><code>vignettes/raceland-intro2.Rmd</code></a></small>
      <div class="hidden name"><code>raceland-intro2.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>INTRODUCTION</h1>
<p>The <strong>raceland</strong> package implements a computational framework for a pattern-based, zoneless analysis and visualization of (ethno)racial topography. It is a reimagined approach for analyzing residential segregation and racial diversity based on the concept of ‘landscape’ used in the domain of landscape ecology. An overview of the implemented method is presented in the first vignette. Here we demonstrate, how the <strong>raceland</strong> package can be used for describing racial landscape at different spatial scales.</p>
<p><strong>Racial landscape method</strong> is based on the raster gridded data, and unlike the previous methods, does not depend on the division for specific zones (census tract, census block, etc.). Calculation of racial diversity (entropy) and racial segregation (mutual information) can be performed for the whole area of interests (i.e., metropolitan area) without introducing any arbitrary divisions. Racial landscape method also allows for performing the calculation at different spatial scales.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># install required packages </span>
<span class="kw">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="st">"raceland"</span>,                
  <span class="st">"comat"</span>,            
  <span class="st">"rgdal"</span>,   
  <span class="st">"raster"</span>,
  <span class="st">"sf"</span>,              
  <span class="st">"dplyr"</span>,
  <span class="st">"RColorBrewer"</span>
)
<span class="kw">to_install</span> <span class="op">=</span> <span class="op">!</span><span class="kw">pkgs</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span>()
<span class="co">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="kw">to_install</span>)) {
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="kw">pkgs</span>[<span class="kw">to_install</span>])
}
</pre></div>
<p>A computational framework requires a few steps (see the first vignette for details) before calculating IT-metrics:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># reading input data</span>
<span class="kw">list_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"rast_data"</span>, package = <span class="st">"raceland"</span>),
                         full.names = <span class="fl">TRUE</span>)
<span class="kw">race_raster</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span>(<span class="kw">list_raster</span>)
<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,</span>
<span class="co">#&gt;  but +towgs84= values preserved</span>

<span class="co"># constructing racial landscape</span>
<span class="kw">real_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_realizations.html">create_realizations</a></span>(x = <span class="kw">race_raster</span>, n = <span class="fl">100</span>)

<span class="co"># calculating local subpopulation densities</span>
<span class="kw">dens_raster</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_densities.html">create_densities</a></span>(<span class="kw">real_raster</span>, <span class="kw">race_raster</span>, window_size = <span class="fl">10</span>)
</pre></div>
</div>
<div id="describing-local-racial-patterns-of-racial-landscapes-at-different-spatial-scales" class="section level1">
<h1 class="hasAnchor">
<a href="#describing-local-racial-patterns-of-racial-landscapes-at-different-spatial-scales" class="anchor"></a>DESCRIBING LOCAL RACIAL PATTERNS OF RACIAL LANDSCAPES AT DIFFERENT SPATIAL SCALES</h1>
<div id="defining-local-patterns" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-local-patterns" class="anchor"></a>Defining local patterns</h2>
<p>Let consider an example presented below. The racial landscape covers the area of 16 by 16 cells. Such an area can be divided into a square-shaped block of cells. Each square of cells will represent a local pattern (a local landscape), and for each local pattern, IT metrics (entropy and mutual information) are calculated. The extent of a local pattern is defined by two parameters: <em>size</em> and <em>shift</em>.</p>
<ul>
<li>
<em>Size</em> parameter, expressed in the numbers of cells, is a length of the side of a square-shaped block of cells. It defines the extent of a local pattern.</li>
<li>
<em>Shift</em> parameter defines the shift between adjacent squares of cells along with the N-S and W-E directions. It describes the density (resolution) of the output grid. The resolution of the output map will be reduced to the new resolution = original resolution x shift. When:
<ul>
<li><p>shift == size - the input map will be divided into a grid of non-overlaping square windows. Each square window defines the extent of a local pattern.</p></li>
<li><p>shift &lt; size - results in the grid of overlapping square windows. A local pattern is calculated from the square window defined by size parameter; the next square window is shifted (in N-S and W-E directions) by the number of cells defined by <em>shift</em> parameter.</p></li>
</ul>
</li>
</ul>
<p>The example presented below consists of the racial landscape 16 by 16 cells. Setting <code>size = 4</code> (and <code>shift= 4</code>) results in dividing the racial landscape into four squared windows, each 4x4 cells. Each window represents a local pattern. For each local pattern, IT metrics can be calculated, and the results will be assigned to the resultant grid of square windows. In fact, the original racial landscape with 16x16 cells is reduced to the 2x2 ‘large cells’.</p>
<p>Setting <code>size=4</code> and <code>shift = 2</code> results in overlapping square windows. First, the window of the size 4x4 defines the local pattern (see dark blue square). In the next step, this window is shifted by two cells to the right, and the new local pattern is selected (see the light blue square). It will create a resultant grid of the cell size defined by the shift parameter.</p>
<p><img src="fig3size_shift.png" width="100%"></p>
</div>
<div id="calculate-it-metrics-from-local-patterns-1" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-it-metrics-from-local-patterns-1" class="anchor"></a>Calculate IT metrics from local patterns (1)</h2>
<p>The <code><a href="../reference/create_grid.html">create_grid()</a></code> function creates spatial object with a grid (each ‘cell’ is defined by size and shift). This function requires the RasterStack object with realizations (racial landscapes) and size parameter. If the shift parameter is not set, it is assumed that <code>size=shift</code>. Below such grid is imposed into the racial landscape to show local patterns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">race_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#F16667"</span>, <span class="st">"#6EBE44"</span>, <span class="st">"#7E69AF"</span>, <span class="st">"#C77213"</span>, <span class="st">"#F8DF1D"</span>)
<span class="kw">grid_sf</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_grid.html">create_grid</a></span>(<span class="kw">real_raster</span>, size = <span class="fl">20</span>)
<span class="fu"><a href="../reference/plot_realization.html">plot_realization</a></span>(<span class="kw">real_raster</span>[[<span class="fl">1</span>]], <span class="kw">race_raster</span>, hex = <span class="kw">race_colors</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="kw">grid_sf</span>), add = <span class="fl">TRUE</span>, lwd = <span class="fl">2</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/fig5-1.png" width="40%" style="display: block; margin: auto;"></p>
<p>The <code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code> function is used to calculate IT metrics. Parameter <code>size=20</code> means that the area of interests will be divided into a grid of local patterns of the size 20x20 cells (which in this case corresponds to the square of 0.6 km x 0.6km). The <code>neighboorhood = 4</code> defines that adjacencies between cells are defined in four directions, <code>fun="mean"</code> calculate average values of population density from adjacent cells, <code>threshold = 0.5</code> - calculation will be performed if there is at least 50% of non-NA cells.</p>
<p>IT metrics are calculated for each local pattern for each realization. The output table will have 900 rows (there are nine local patterns of size 20x20 cells and 100 realizations).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">metr_df_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_metrics.html">calculate_metrics</a></span>(x = <span class="kw">real_raster</span>, w = <span class="kw">dens_raster</span>, 
                               neighbourhood = <span class="fl">4</span>, fun = <span class="st">"mean"</span>, 
                               size = <span class="fl">20</span>, threshold = <span class="fl">0.5</span>)
<span class="kw">metr_df_20</span>[<span class="kw">metr_df_20</span><span class="op">$</span><span class="kw">realization</span> <span class="op">==</span> <span class="fl">1</span>, ]
<span class="co">#&gt;   realization row col      ent  joinent  condent     mutinf</span>
<span class="co">#&gt; 1           1   1   1 1.281910 2.547961 1.266051 0.01585855</span>
<span class="co">#&gt; 2           1   1   2 1.579126 2.994151 1.415025 0.16410150</span>
<span class="co">#&gt; 3           1   1   3 1.432791 2.824495 1.391703 0.04108823</span>
<span class="co">#&gt; 4           1   2   1 1.573958 2.971520 1.397562 0.17639541</span>
<span class="co">#&gt; 5           1   2   2 1.525056 2.986140 1.461084 0.06397151</span>
<span class="co">#&gt; 6           1   2   3 1.520459 2.880951 1.360492 0.15996759</span>
<span class="co">#&gt; 7           1   3   1 1.298133 2.380205 1.082072 0.21606071</span>
<span class="co">#&gt; 8           1   3   2 1.544456 3.068553 1.524097 0.02035939</span>
<span class="co">#&gt; 9           1   3   3 1.422459 2.765839 1.343380 0.07907882</span>
</pre></div>
<p>Racial topography at the analyzed scale is quantified as an ensemble average from multiple realizations. First, for each square window is calculated the average value of entropy and mutual information based on 100 realizations. The table below shows the mean (<code>ent_mean</code>, <code>mutinf_mean</code>) and standard deviation (<code>ent_sd</code>, <code>mutinf_sd</code>) values for each square window.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">smr</span> <span class="op">=</span> <span class="kw">metr_df_20</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="kw">row</span>, <span class="kw">col</span>) <span class="op">%&gt;%</span>
  <span class="fu">summarize</span>(
    ent_mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">ent</span>, na.rm = <span class="fl">TRUE</span>),
    ent_sd = <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="kw">ent</span>, na.rm = <span class="fl">TRUE</span>),
    mutinf_mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">mutinf</span>, na.rm = <span class="fl">TRUE</span>),
    mutinf_sd = <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="kw">mutinf</span>, na.rm = <span class="fl">TRUE</span>)
  )
<span class="co">#&gt; `summarise()` regrouping output by 'row' (override with `.groups` argument)</span>
<span class="kw">smr</span>
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt; # Groups:   row [3]</span>
<span class="co">#&gt;     row   col ent_mean ent_sd mutinf_mean mutinf_sd</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     1     1.26 0.0437      0.0201   0.00899</span>
<span class="co">#&gt; 2     1     2     1.59 0.0110      0.164    0.0259 </span>
<span class="co">#&gt; 3     1     3     1.42 0.0276      0.0458   0.0146 </span>
<span class="co">#&gt; 4     2     1     1.61 0.0242      0.157    0.0391 </span>
<span class="co">#&gt; 5     2     2     1.52 0.0228      0.0329   0.0117 </span>
<span class="co">#&gt; 6     2     3     1.52 0.0313      0.157    0.0287 </span>
<span class="co">#&gt; 7     3     1     1.38 0.0489      0.137    0.0427 </span>
<span class="co">#&gt; 8     3     2     1.54 0.0305      0.0163   0.00616</span>
<span class="co">#&gt; 9     3     3     1.42 0.0286      0.0490   0.0157</span>
</pre></div>
<p>Then the averages from the mean values of entropy and mutual information are calculated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">smr</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/select.html">select</a></span>(<span class="op">-</span><span class="kw">row</span>, <span class="op">-</span><span class="kw">col</span>) <span class="op">%&gt;%</span> 
  <span class="fu">summarise_all</span>(<span class="kw">mean</span>)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   ent_mean ent_sd mutinf_mean mutinf_sd</span>
<span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1.47 0.0299      0.0865    0.0215</span>
</pre></div>
<div id="racial-diversity-segregation-classification" class="section level3">
<h3 class="hasAnchor">
<a href="#racial-diversity-segregation-classification" class="anchor"></a>Racial diversity-segregation classification</h3>
<p>Racial diversity and segregation can be analyzed and displayed separately. However, much more information can be gained by visualizing those two measures at the same time. For this purpose, entropy and mutual information are reclassified into three classes (1-low, 2-medium, 3-high). By joining those two classification, we obtain 9 classes, each describing the level of diversity and segregation: 11 - low segregation/low diversity; 12-low segregation/medium diversity; 13-low segregation/high diversity; 21 - medium segregation/low diversity; 22-medium segregation/medium diversity; 23-medium segregation/high diversity; 31 - high segregation/low diversity; 32-high segregation/medium diversity; 33-high segregation/high diversity.</p>
<p>Each class is coded by one color using bivariate palette (see below).</p>
<p><img src="fig4_bivariate.png" width="40%"></p>
<p>The <code>bivariate_classification()</code> function presented below takes three arguments (<code>entropy</code> - a vector of entropy values, <code>mutual_information</code> - a vector of mutual information values, <code>n</code> - a number of categories in racial landscape) and return a 9-coded vector of racial segregation/divesity classes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># n is a number of categories in racial landscape</span>
<span class="kw">bivariate_classification</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">entropy</span>, <span class="kw">mutual_information</span>, <span class="kw">n</span>) {
  
  <span class="co"># calculate bivariate classification</span>
  <span class="kw">nent</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log2</a></span>(<span class="kw">n</span>)
  <span class="kw">ent_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html">cut</a></span>(<span class="kw">entropy</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.66</span>, <span class="fl">1.33</span>, <span class="kw">nent</span>), labels = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>), 
                include.lowest = <span class="fl">TRUE</span>, right = <span class="fl">TRUE</span>)
  <span class="kw">ent_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="kw">ent_cat</span>))
  
  <span class="kw">mut_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html">cut</a></span>(<span class="kw">mutual_information</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.33</span>, <span class="fl">0.66</span>, <span class="fl">1</span>), labels = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>), 
                include.lowest = <span class="fl">TRUE</span>, right = <span class="fl">TRUE</span>)
  <span class="kw">mut_cat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="kw">mut_cat</span>))
  
  <span class="kw">bivar_cls</span> <span class="op">=</span> <span class="kw">mut_cat</span> <span class="op">+</span> <span class="kw">ent_cat</span>
  <span class="kw">bivar_cls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span>(<span class="kw">bivar_cls</span>)
  
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">bivar_cls</span>)
}
</pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">smr</span><span class="op">$</span><span class="kw">bivar_cls</span> <span class="op">=</span> <span class="fu">bivariate_classification</span>(entropy = <span class="kw">smr</span><span class="op">$</span><span class="kw">ent_mean</span>, 
                                         mutual_information = <span class="kw">smr</span><span class="op">$</span><span class="kw">mutinf_mean</span>,
                                         n = <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span>(<span class="kw">race_raster</span>))
</pre></div>
</div>
<div id="mapping-local-racial-diversity-and-racial-segregation" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-local-racial-diversity-and-racial-segregation" class="anchor"></a>Mapping local racial diversity and racial segregation</h3>
<p>The average value of entropy and mutual information calculated for each square-shaped window from all realizations can be joined to the spatial grid object. Such operation allows for mapping metrics and shows how segregation and racial diversity change over the area.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># join IT-metric to the grid</span>
<span class="kw">attr_grid</span> <span class="op">=</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">grid_sf</span>, <span class="kw">smr</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"row"</span>, <span class="st">"col"</span>))
</pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># calculate breaks parameter for plotting entropy and mutual information</span>
<span class="co"># the values of entropy and mutual information are divided into equal breaks</span>
<span class="kw">ent_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">2</span>, by = <span class="fl">0.25</span>), <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log2</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span>(<span class="kw">race_raster</span>)))
<span class="kw">mut_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, by = <span class="fl">0.1</span>)
</pre></div>
</div>
<div id="mapping-racial-diversity" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-diversity" class="anchor"></a>Mapping racial diversity</h3>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid</span>[<span class="st">"ent_mean"</span>], breaks = <span class="kw">ent_breaks</span>, key.pos = <span class="fl">1</span>, 
     pal = <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw">RColorBrewer</span>::<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">ent_breaks</span>) <span class="op">-</span> <span class="fl">1</span>, name = <span class="st">"RdBu"</span>)),
     <span class="co"># pal = grDevices::hcl.colors(length(ent_breaks) - 1, palette = "Blue-Red"),</span>
     bty = <span class="st">"n"</span>, main = <span class="st">"Racial diversity (Entropy)"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-racial-segregation" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-segregation" class="anchor"></a>Mapping racial segregation</h3>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid</span>[<span class="st">"mutinf_mean"</span>], breaks = <span class="kw">mut_breaks</span>, key.pos = <span class="fl">1</span>, 
     pal = <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw">RColorBrewer</span>::<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">mut_breaks</span>) <span class="op">-</span> <span class="fl">1</span>, name = <span class="st">"RdBu"</span>)),
     <span class="co"># pal = grDevices::hcl.colors(length(mut_breaks) - 1, palette = "Blue-Red"),</span>
     bty = <span class="st">"n"</span>, main = <span class="st">"Racial segregation (Mutual information)"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-racial-segregation-and-diversity-using-bivariate-classification" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-segregation-and-diversity-using-bivariate-classification" class="anchor"></a>Mapping racial segregation and diversity using bivariate classification</h3>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">biv_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"11"</span> = <span class="st">"#e8e8e8"</span>, <span class="st">"12"</span> = <span class="st">"#e4acac"</span>, <span class="st">"13"</span> = <span class="st">"#c85a5a"</span>, <span class="st">"21"</span> = <span class="st">"#b0d5df"</span>,
               <span class="st">"22"</span> = <span class="st">"#ad9ea5"</span>, <span class="st">"23"</span> = <span class="st">"#985356"</span>, <span class="st">"31"</span> = <span class="st">"#64acbe"</span>, <span class="st">"32"</span>= <span class="st">"#627f8c"</span>, 
               <span class="st">"33"</span> = <span class="st">"#574249"</span>)
<span class="kw">bcat</span> <span class="op">=</span> <span class="kw">biv_colors</span>[<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="kw">biv_colors</span>)<span class="op">%in%</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="kw">attr_grid</span><span class="op">$</span><span class="kw">bivar_cls</span>)]
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid</span>[<span class="st">"bivar_cls"</span>], pal = <span class="kw">bcat</span>, main = <span class="st">"Racial diversity and residential segregation"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="calculate-it-metrics-from-local-patterns-overlapping-windows" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-it-metrics-from-local-patterns-overlapping-windows" class="anchor"></a>Calculate IT metrics from local patterns (overlapping windows)</h3>
<p>The next example shows how to calculate a local pattern using overlapping windows. This option is recommended to use, especially for a larger size value. Using overlapping windows does not introduce arbitrary boundaries.</p>
<p>To obtain overlapping windows the <code><a href="../reference/calculate_metrics.html">calculate_metrics()</a></code> function requires additional argument - <code>shift</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co"># calculate metrics for overlapping windows</span>
<span class="kw">metr_df_10</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_metrics.html">calculate_metrics</a></span>(x = <span class="kw">real_raster</span>, w = <span class="kw">dens_raster</span>, 
                               neighbourhood = <span class="fl">4</span>, fun = <span class="st">"mean"</span>, 
                               size = <span class="fl">20</span>, shift = <span class="fl">10</span>, threshold = <span class="fl">0.5</span>)

<span class="kw">smr10</span> <span class="op">=</span> <span class="kw">metr_df_10</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="kw">row</span>, <span class="kw">col</span>) <span class="op">%&gt;%</span>
  <span class="fu">summarize</span>(
    ent_mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">ent</span>, na.rm = <span class="fl">TRUE</span>),
    ent_sd = <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="kw">ent</span>, na.rm = <span class="fl">TRUE</span>),
    mutinf_mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">mutinf</span>, na.rm = <span class="fl">TRUE</span>),
    mutinf_sd = <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="kw">mutinf</span>, na.rm = <span class="fl">TRUE</span>)
  )
<span class="co">#&gt; `summarise()` regrouping output by 'row' (override with `.groups` argument)</span>

<span class="kw">smr10</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/select.html">select</a></span>(<span class="op">-</span><span class="kw">row</span>, <span class="op">-</span><span class="kw">col</span>) <span class="op">%&gt;%</span> 
  <span class="fu">summarise_all</span>(<span class="kw">mean</span>)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   ent_mean ent_sd mutinf_mean mutinf_sd</span>
<span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1.48 0.0327      0.0820    0.0228</span>

<span class="co"># calculate bivariate classification</span>
<span class="kw">smr10</span><span class="op">$</span><span class="kw">bivar_cls</span> <span class="op">=</span> <span class="fu">bivariate_classification</span>(
  entropy = <span class="kw">smr10</span><span class="op">$</span><span class="kw">ent_mean</span>,
  mutual_information = <span class="kw">smr10</span><span class="op">$</span><span class="kw">mutinf_mean</span>,
  n = <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span>(<span class="kw">race_raster</span>)
)
</pre></div>
</div>
</div>
<div id="mapping-local-racial-diversity-and-racial-segregation-1" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-local-racial-diversity-and-racial-segregation-1" class="anchor"></a>Mapping local racial diversity and racial segregation</h2>
<p>The average value of entropy and mutual information calculated for each square-shaped window from all realizations can be joined to spatial grid object (created by <code><a href="../reference/create_grid.html">create_grid()</a></code>). For overlapping windows, the resolution of the grid will be defined by <em>shift</em> parameter.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co"># create spatial grid object</span>
<span class="kw">grid_sf10</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_grid.html">create_grid</a></span>(<span class="kw">real_raster</span>, size = <span class="fl">20</span>, shift = <span class="fl">10</span>)

<span class="co"># join IT-metrics to the grid</span>
<span class="kw">attr_grid10</span> <span class="op">=</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">grid_sf10</span>, <span class="kw">smr10</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"row"</span>, <span class="st">"col"</span>))
</pre></div>
<div id="mapping-racial-diversity-1" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-diversity-1" class="anchor"></a>Mapping racial diversity</h3>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid10</span>[<span class="st">"ent_mean"</span>], breaks = <span class="kw">ent_breaks</span>, key.pos = <span class="fl">1</span>, 
     pal = <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw">RColorBrewer</span>::<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">ent_breaks</span>) <span class="op">-</span> <span class="fl">1</span>, name = <span class="st">"RdBu"</span>)),
     <span class="co"># pal = grDevices::hcl.colors(length(ent_breaks) - 1, palette = "Blue-Red"),</span>
     bty = <span class="st">"n"</span>, main = <span class="st">"Racial diversity (Entropy)"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-racial-segregation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-segregation-1" class="anchor"></a>Mapping racial segregation</h3>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid10</span>[<span class="st">"mutinf_mean"</span>], breaks = <span class="kw">mut_breaks</span>, key.pos = <span class="fl">1</span>,
     pal = <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw">RColorBrewer</span>::<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">mut_breaks</span>) <span class="op">-</span> <span class="fl">1</span>, name = <span class="st">"RdBu"</span>)),
     <span class="co"># pal = grDevices::hcl.colors(length(mut_breaks) - 1, palette = "Blue-Red"),</span>
     bty = <span class="st">"n"</span>, main = <span class="st">"Racial segregation (Mutual information)"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-racial-segregation-and-diversity-using-bivariate-classification-1" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-racial-segregation-and-diversity-using-bivariate-classification-1" class="anchor"></a>Mapping racial segregation and diversity using bivariate classification</h3>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="co"># `biv_color`s defines a bivariate palette, </span>
<span class="co"># `bcat` selects only colors for categories available for analyzed areas</span>
<span class="kw">biv_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"11"</span> = <span class="st">"#e8e8e8"</span>, <span class="st">"12"</span> = <span class="st">"#e4acac"</span>, <span class="st">"13"</span> = <span class="st">"#c85a5a"</span>, <span class="st">"21"</span> = <span class="st">"#b0d5df"</span>, 
               <span class="st">"22"</span> = <span class="st">"#ad9ea5"</span>, <span class="st">"23"</span> = <span class="st">"#985356"</span>, <span class="st">"31"</span> = <span class="st">"#64acbe"</span>,<span class="st">"32"</span> = <span class="st">"#627f8c"</span>,
               <span class="st">"33"</span> = <span class="st">"#574249"</span>)
<span class="kw">bcat</span> <span class="op">=</span> <span class="kw">biv_colors</span>[<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="kw">biv_colors</span>)<span class="op">%in%</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="kw">attr_grid10</span><span class="op">$</span><span class="kw">bivar_cls</span>)]
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw">attr_grid10</span>[<span class="st">"bivar_cls"</span>], pal = <span class="kw">bcat</span>, main = <span class="st">"Racial diversity and residential segregation"</span>)
</pre></div>
<p><img src="raceland-intro2_files/figure-html/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jakub Nowosad, Anna Dmowska, Tomasz Stepinski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
